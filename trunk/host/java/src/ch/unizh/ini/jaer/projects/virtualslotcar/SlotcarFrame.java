/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * SlotcarFrame.java
 *
 * Created on Jun 11, 2010, 7:02:14 PM
 */

package ch.unizh.ini.jaer.projects.virtualslotcar;
import java.awt.Point;
import java.awt.geom.Point2D;
import java.awt.Dimension;
import java.lang.String;

/**
 *
 * @author Michael Pfeiffer
 */
public class SlotcarFrame extends javax.swing.JFrame {

    // Track that is designed
    SlotcarTrack track = null;

    // Modes for adding or deleting track points
    public static final int NOTHING_SELECTED_MODE = 0;
    public static final int ADD_POINT_MODE = 1;
    public static final int DELETE_POINT_MODE = 2;


    // Current mode for adding or removing points
    private int currentMode;

    /** Creates new form SlotcarFrame */
    public SlotcarFrame() {
        track = new SlotcarTrack();
        initComponents();
        EditorPanel.setTrack(track);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        ClearButton = new javax.swing.JButton();
        LoadButton = new javax.swing.JButton();
        SaveButton = new javax.swing.JButton();
        EditorPanel = new ch.unizh.ini.jaer.projects.virtualslotcar.TrackEditor();
        NumPointsLabel = new javax.swing.JLabel();
        NumPointsLabel1 = new javax.swing.JLabel();
        AddPointsButton = new javax.swing.JToggleButton();
        DeletePointsButton = new javax.swing.JToggleButton();
        pointLabel = new javax.swing.JLabel();
        lengthLabel = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        ClearButton.setText("Clear Track");
        ClearButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ClearButtonActionPerformed(evt);
            }
        });

        LoadButton.setText("Load Track");

        SaveButton.setText("Save Track");

        EditorPanel.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                EditorPanelMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout EditorPanelLayout = new javax.swing.GroupLayout(EditorPanel);
        EditorPanel.setLayout(EditorPanelLayout);
        EditorPanelLayout.setHorizontalGroup(
            EditorPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 567, Short.MAX_VALUE)
        );
        EditorPanelLayout.setVerticalGroup(
            EditorPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 411, Short.MAX_VALUE)
        );

        NumPointsLabel.setText("Num Points");

        NumPointsLabel1.setText("Track Length");

        AddPointsButton.setText("Add Points");
        AddPointsButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                AddPointsButtonActionPerformed(evt);
            }
        });

        DeletePointsButton.setText("Delete Points");
        DeletePointsButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                DeletePointsButtonActionPerformed(evt);
            }
        });

        pointLabel.setText("0");

        lengthLabel.setText("0");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(EditorPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 66, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(NumPointsLabel)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(NumPointsLabel1)
                                    .addGap(14, 14, 14))
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(DeletePointsButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(AddPointsButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(42, 42, 42)
                        .addComponent(ClearButton, javax.swing.GroupLayout.PREFERRED_SIZE, 123, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(LoadButton, javax.swing.GroupLayout.PREFERRED_SIZE, 123, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(SaveButton, javax.swing.GroupLayout.PREFERRED_SIZE, 123, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(pointLabel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(lengthLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 26, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(EditorPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 31, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(ClearButton)
                    .addComponent(LoadButton)
                    .addComponent(SaveButton)))
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(pointLabel)
                    .addComponent(NumPointsLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(NumPointsLabel1)
                    .addComponent(lengthLabel))
                .addGap(50, 50, 50)
                .addComponent(AddPointsButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(DeletePointsButton)
                .addGap(309, 309, 309))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void ClearButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ClearButtonActionPerformed
        track.clear();
        pointLabel.setText(String.valueOf(track.getNumPoints()));
        lengthLabel.setText(String.valueOf(track.getTrackLength()));
        repaint();
    }//GEN-LAST:event_ClearButtonActionPerformed

    private void EditorPanelMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_EditorPanelMouseClicked
        // TODO add your handling code here:
        int ClickX = evt.getX();
        int ClickY = evt.getY();

        System.out.println("Click: " + ClickX + " / " + ClickY + " / " + evt.getPoint());

        Point2D normPoint = normalizedPosition(evt.getPoint());

        switch (currentMode) {
            case ADD_POINT_MODE: {
                System.out.println("Adding point " + normPoint);
                track.addPoint(normPoint);
                pointLabel.setText(String.valueOf(track.getNumPoints()));
                lengthLabel.setText(String.format("%.2g", track.getTrackLength()));

                // EditorPanel.setTrack(track);
                break;
            }
            case DELETE_POINT_MODE: {
                int closestIdx = track.findClosest(normPoint);
                System.out.println("Deleting Point " + track.getPoint(closestIdx));
                track.deletePoint(closestIdx);
                pointLabel.setText(String.valueOf(track.getNumPoints()));
                lengthLabel.setText(String.format("%.2g", track.getTrackLength()));
                // EditorPanel.setTrack(track);
                break;
            }
            default: {
                // Do nothing
            }
        }

        // Re-paint the track
        EditorPanel.repaint();
    }//GEN-LAST:event_EditorPanelMouseClicked

    private void AddPointsButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_AddPointsButtonActionPerformed
        // TODO add your handling code here:
        if (AddPointsButton.isSelected()) {
            // Make sure that other button is deselected
            DeletePointsButton.setSelected(false);
            DeletePointsButton.repaint();

            currentMode = ADD_POINT_MODE;
        }
    }//GEN-LAST:event_AddPointsButtonActionPerformed

    private void DeletePointsButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_DeletePointsButtonActionPerformed
        // TODO add your handling code here:
        if (DeletePointsButton.isSelected()) {
            // Make sure that other button is deselected
            AddPointsButton.setSelected(false);
            AddPointsButton.repaint();

            currentMode = DELETE_POINT_MODE;
        }
    }//GEN-LAST:event_DeletePointsButtonActionPerformed

    /** Computes the normalized position of a point wrt. size and position of the
     * drawing panel.
     * @param pos Position of the mouse click in frame coordinates
     * @return Normalized position of the mouse position
     */
    private Point2D normalizedPosition(Point pos) {
       Dimension d = EditorPanel.getSize();
       Point2D np = new Point2D.Double(((double) pos.x) / d.width, ((double) pos.y) / d.height);
       return np;
    }


    /** Repaint by refreshing the labels */
    @Override
    public void repaint() {

        super.repaint();
    }

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new SlotcarFrame().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JToggleButton AddPointsButton;
    private javax.swing.JButton ClearButton;
    private javax.swing.JToggleButton DeletePointsButton;
    private ch.unizh.ini.jaer.projects.virtualslotcar.TrackEditor EditorPanel;
    private javax.swing.JButton LoadButton;
    private javax.swing.JLabel NumPointsLabel;
    private javax.swing.JLabel NumPointsLabel1;
    private javax.swing.JButton SaveButton;
    private javax.swing.JLabel lengthLabel;
    private javax.swing.JLabel pointLabel;
    // End of variables declaration//GEN-END:variables
}
