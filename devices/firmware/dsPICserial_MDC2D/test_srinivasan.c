/*
 * Copyright June 13, 2011 Andreas Steiner, Inst. of Neuroinformatics, UNI-ETH Zurich
 * This file is part of uart_MDC2D.

 * uart_MDC2D is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.

 * uart_MDC2D is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License
 * along with uart_MDC2D.  If not, see <http://www.gnu.org/licenses/>.
 */


/*! \file test_srinivasan.c
 * use this file to test the algorithm implementation; in case something
 * goes wrong (error values returned), catch the erronous frame data,
 * translate it to a C array for inclusion in this file and use the
 * MPLAB simulator to find the exact error source and fix the implementation
 */

#include <p33Fxxxx.h>

#include "config.h"
#include "time.h"
#include "port.h"
#include "srinivasan.h"


// caused erroneous result
// expected dx=11B7 dy=4BFB
int frame1[]={
345, 338, 337, 337, 339, 346, 343, 340, 341, 341, 345, 347, 345, 344, 346, 345, 350, 358, 363, 372,
345, 343, 340, 336, 338, 344, 342, 342, 344, 344, 347, 347, 349, 345, 350, 349, 352, 352, 363, 364,
357, 352, 355, 348, 352, 356, 357, 361, 363, 362, 366, 366, 367, 368, 371, 368, 365, 369, 378, 379,
374, 370, 370, 370, 375, 381, 376, 374, 379, 377, 378, 380, 384, 381, 384, 386, 387, 388, 391, 392,
390, 390, 392, 392, 393, 397, 393, 395, 398, 396, 395, 396, 398, 397, 397, 398, 399, 401, 403, 398,
400, 400, 400, 399, 402, 408, 403, 402, 404, 403, 404, 405, 408, 408, 407, 406, 400, 401, 401, 408,
392, 395, 387, 387, 389, 394, 393, 392, 394, 393, 394, 393, 391, 387, 384, 384, 388, 386, 385, 385,
378, 380, 381, 382, 386, 393, 387, 390, 391, 397, 402, 397, 394, 386, 384, 377, 377, 376, 375, 376,
361, 358, 356, 359, 359, 363, 363, 361, 361, 365, 366, 363, 364, 360, 360, 360, 362, 355, 358, 355,
348, 348, 348, 346, 346, 348, 348, 352, 351, 357, 358, 357, 350, 348, 355, 350, 348, 349, 353, 352,
344, 339, 339, 338, 342, 350, 348, 344, 344, 343, 345, 348, 348, 344, 347, 348, 348, 350, 355, 359,
340, 336, 338, 338, 342, 347, 346, 349, 352, 349, 352, 350, 350, 346, 350, 353, 354, 353, 358, 363,
351, 352, 352, 351, 355, 361, 357, 358, 361, 360, 363, 364, 367, 365, 367, 368, 368, 370, 378, 384,
373, 372, 374, 373, 376, 382, 379, 379, 381, 383, 387, 385, 383, 383, 389, 386, 387, 389, 394, 400,
392, 386, 387, 387, 392, 397, 392, 390, 394, 393, 398, 399, 400, 396, 398, 401, 405, 407, 410, 411,
403, 396, 394, 392, 396, 402, 395, 397, 401, 400, 402, 406, 407, 406, 407, 407, 409, 409, 412, 412,
403, 402, 402, 403, 405, 410, 407, 408, 411, 408, 414, 414, 414, 412, 409, 398, 404, 394, 386, 379,
392, 400, 402, 403, 408, 413, 404, 408, 411, 404, 411, 414, 415, 410, 401, 401, 395, 385, 380, 376,
377, 393, 400, 395, 397, 400, 388, 385, 398, 388, 378, 378, 379, 369, 360, 360, 364, 358, 360, 349,
365, 373, 373, 372, 373, 379, 386, 380, 374, 370, 371, 368, 363, 357, 360, 356, 354, 347, 348, 343,
};
int frame2[]={
354, 345, 344, 349, 347, 355, 353, 352, 351, 352, 355, 357, 355, 353, 355, 355, 356, 363, 364, 373,
352, 352, 352, 347, 346, 351, 350, 352, 355, 355, 352, 352, 358, 348, 352, 350, 355, 352, 362, 361,
354, 342, 346, 339, 340, 346, 346, 348, 352, 348, 353, 350, 353, 354, 354, 351, 349, 349, 363, 366,
351, 344, 342, 341, 343, 354, 352, 343, 351, 348, 350, 350, 358, 354, 356, 359, 361, 362, 370, 372,
364, 367, 367, 365, 365, 375, 371, 369, 375, 371, 375, 376, 372, 373, 378, 381, 377, 382, 386, 390,
386, 383, 383, 382, 384, 387, 384, 385, 389, 383, 391, 391, 392, 392, 392, 390, 391, 395, 398, 405,
397, 398, 395, 394, 395, 403, 400, 398, 404, 401, 402, 402, 401, 398, 396, 400, 401, 401, 401, 405,
401, 402, 402, 402, 403, 411, 408, 408, 410, 410, 413, 411, 408, 405, 408, 404, 403, 403, 398, 400,
387, 387, 381, 386, 386, 388, 391, 390, 386, 394, 398, 391, 390, 386, 386, 385, 389, 376, 380, 369,
370, 376, 375, 374, 371, 372, 373, 384, 376, 387, 389, 390, 379, 372, 384, 376, 371, 369, 372, 362,
356, 352, 353, 352, 353, 368, 368, 360, 357, 356, 355, 361, 363, 357, 357, 355, 356, 358, 358, 360,
343, 342, 342, 341, 345, 352, 350, 354, 359, 353, 354, 350, 352, 345, 345, 348, 349, 343, 347, 347,
340, 342, 341, 338, 339, 346, 342, 339, 344, 343, 345, 344, 345, 345, 346, 346, 345, 342, 350, 355,
345, 344, 345, 347, 347, 356, 353, 354, 353, 354, 362, 358, 356, 358, 362, 355, 358, 365, 365, 371,
361, 358, 360, 361, 364, 375, 368, 365, 368, 369, 377, 372, 376, 377, 377, 378, 382, 384, 389, 393,
383, 383, 384, 381, 381, 390, 385, 386, 394, 391, 393, 398, 393, 394, 393, 396, 397, 395, 403, 408,
399, 390, 389, 390, 393, 400, 395, 393, 401, 396, 402, 401, 403, 399, 402, 403, 405, 405, 405, 407,
405, 395, 393, 393, 396, 404, 398, 397, 403, 401, 405, 406, 408, 406, 406, 411, 412, 409, 411, 411,
403, 402, 405, 402, 405, 414, 407, 404, 412, 411, 408, 407, 411, 402, 389, 389, 400, 386, 393, 369,
394, 405, 407, 402, 406, 410, 413, 413, 411, 406, 406, 401, 396, 389, 395, 384, 383, 365, 369, 358,
};




/*
// caused overlfow in nominator
// expected values : dx=FF42 (-00BE) dy=56CE
// shifts nominator by 1bit
int frame1[]={
358, 351, 350, 347, 350, 360, 355, 351, 349, 347, 355, 359, 359, 358, 359, 357, 365, 373, 377, 384,
363, 358, 354, 350, 354, 360, 357, 359, 360, 360, 365, 366, 368, 366, 370, 371, 372, 373, 380, 382,
378, 377, 380, 379, 382, 388, 384, 386, 390, 390, 391, 390, 392, 389, 394, 393, 389, 393, 395, 393,
394, 394, 396, 395, 399, 403, 400, 402, 401, 399, 400, 400, 403, 400, 404, 404, 404, 404, 401, 404,
396, 394, 396, 395, 395, 397, 392, 396, 396, 397, 392, 394, 401, 396, 391, 392, 398, 396, 395, 385,
382, 382, 385, 385, 387, 397, 387, 383, 391, 392, 386, 386, 389, 390, 392, 389, 378, 380, 378, 387,
367, 368, 361, 361, 363, 369, 365, 365, 367, 367, 368, 367, 366, 364, 363, 361, 363, 362, 364, 365,
353, 352, 352, 351, 355, 360, 355, 356, 358, 362, 367, 364, 363, 357, 356, 352, 354, 353, 356, 361,
345, 342, 341, 342, 343, 348, 345, 345, 345, 346, 348, 347, 350, 346, 347, 349, 350, 347, 352, 354,
340, 338, 338, 336, 337, 341, 339, 341, 342, 346, 348, 348, 344, 342, 348, 347, 347, 349, 357, 361,
352, 345, 345, 343, 348, 355, 352, 349, 352, 352, 356, 360, 358, 355, 360, 363, 364, 367, 373, 377,
366, 361, 363, 363, 366, 371, 369, 372, 378, 374, 376, 376, 376, 373, 377, 379, 381, 380, 389, 397,
384, 381, 381, 382, 385, 390, 388, 388, 388, 388, 392, 393, 395, 392, 395, 395, 396, 399, 406, 410,
400, 392, 392, 391, 393, 399, 394, 397, 399, 399, 402, 400, 400, 398, 404, 406, 405, 404, 406, 405,
404, 401, 400, 402, 405, 410, 406, 405, 406, 406, 410, 407, 411, 410, 409, 407, 408, 408, 408, 393,
408, 407, 406, 404, 407, 413, 408, 409, 413, 412, 415, 416, 409, 411, 407, 413, 411, 407, 406, 380,
376, 387, 387, 393, 395, 410, 401, 396, 396, 387, 402, 402, 398, 389, 387, 367, 372, 364, 360, 355,
360, 370, 373, 375, 382, 388, 374, 379, 379, 368, 376, 380, 382, 374, 366, 365, 362, 354, 354, 352,
352, 362, 367, 363, 365, 367, 358, 357, 369, 361, 354, 354, 355, 349, 344, 345, 347, 345, 351, 347,
348, 352, 352, 352, 354, 362, 365, 359, 358, 356, 359, 360, 357, 354, 357, 355, 357, 353, 356, 357,
};
int frame2[]={
345, 338, 337, 337, 339, 346, 343, 340, 341, 341, 345, 347, 345, 344, 346, 345, 350, 358, 363, 372,
345, 343, 340, 336, 338, 344, 342, 342, 344, 344, 347, 347, 349, 345, 350, 349, 352, 352, 363, 364,
357, 352, 355, 348, 352, 356, 357, 361, 363, 362, 366, 366, 367, 368, 371, 368, 365, 369, 378, 379,
374, 370, 370, 370, 375, 381, 376, 374, 379, 377, 378, 380, 384, 381, 384, 386, 387, 388, 391, 392,
390, 390, 392, 392, 393, 397, 393, 395, 398, 396, 395, 396, 398, 397, 397, 398, 399, 401, 403, 398,
400, 400, 400, 399, 402, 408, 403, 402, 404, 403, 404, 405, 408, 408, 407, 406, 400, 401, 401, 408,
392, 395, 387, 387, 389, 394, 393, 392, 394, 393, 394, 393, 391, 387, 384, 384, 388, 386, 385, 385,
378, 380, 381, 382, 386, 393, 387, 390, 391, 397, 402, 397, 394, 386, 384, 377, 377, 376, 375, 376,
361, 358, 356, 359, 359, 363, 363, 361, 361, 365, 366, 363, 364, 360, 360, 360, 362, 355, 358, 355,
348, 348, 348, 346, 346, 348, 348, 352, 351, 357, 358, 357, 350, 348, 355, 350, 348, 349, 353, 352,
344, 339, 339, 338, 342, 350, 348, 344, 344, 343, 345, 348, 348, 344, 347, 348, 348, 350, 355, 359,
340, 336, 338, 338, 342, 347, 346, 349, 352, 349, 352, 350, 350, 346, 350, 353, 354, 353, 358, 363,
351, 352, 352, 351, 355, 361, 357, 358, 361, 360, 363, 364, 367, 365, 367, 368, 368, 370, 378, 384,
373, 372, 374, 373, 376, 382, 379, 379, 381, 383, 387, 385, 383, 383, 389, 386, 387, 389, 394, 400,
392, 386, 387, 387, 392, 397, 392, 390, 394, 393, 398, 399, 400, 396, 398, 401, 405, 407, 410, 411,
403, 396, 394, 392, 396, 402, 395, 397, 401, 400, 402, 406, 407, 406, 407, 407, 409, 409, 412, 412,
403, 402, 402, 403, 405, 410, 407, 408, 411, 408, 414, 414, 414, 412, 409, 398, 404, 394, 386, 379,
392, 400, 402, 403, 408, 413, 404, 408, 411, 404, 411, 414, 415, 410, 401, 401, 395, 385, 380, 376,
377, 393, 400, 395, 397, 400, 388, 385, 398, 388, 378, 378, 379, 369, 360, 360, 364, 358, 360, 349,
365, 373, 373, 372, 373, 379, 386, 380, 374, 370, 371, 368, 363, 357, 360, 356, 354, 347, 348, 343,
};
*/

/*
// caused overflow in d/2
int frame1[]={
363, 339, 336, 337, 355, 378, 380, 384, 389, 376, 359, 343, 347, 362, 379, 389, 392, 387, 364, 345,
366, 360, 347, 339, 354, 377, 384, 387, 392, 394, 372, 349, 352, 359, 377, 385, 389, 390, 376, 342,
366, 353, 341, 337, 354, 378, 380, 382, 390, 391, 370, 346, 348, 358, 376, 381, 384, 389, 368, 344,
371, 363, 348, 332, 353, 377, 382, 390, 389, 391, 379, 346, 346, 357, 375, 384, 388, 393, 383, 351,
375, 360, 343, 336, 349, 373, 378, 383, 388, 390, 369, 346, 346, 356, 372, 383, 388, 393, 382, 346,
379, 372, 349, 336, 352, 377, 381, 384, 389, 393, 384, 352, 347, 356, 374, 384, 386, 391, 387, 366,
386, 376, 346, 335, 348, 372, 380, 383, 388, 392, 379, 349, 344, 350, 368, 380, 383, 389, 384, 355,
386, 384, 371, 339, 344, 373, 381, 389, 393, 395, 393, 364, 352, 350, 371, 382, 388, 391, 384, 359,
388, 381, 354, 338, 348, 369, 380, 386, 388, 394, 389, 353, 345, 347, 369, 385, 390, 388, 385, 355,
387, 390, 370, 341, 346, 365, 378, 388, 390, 394, 393, 372, 350, 347, 370, 385, 389, 391, 384, 361,
387, 386, 364, 340, 351, 377, 384, 388, 389, 389, 386, 363, 352, 348, 368, 383, 390, 394, 389, 369,
388, 392, 375, 339, 349, 371, 381, 387, 395, 394, 393, 380, 356, 347, 368, 383, 389, 388, 388, 377,
391, 395, 377, 343, 347, 370, 381, 385, 390, 391, 391, 373, 353, 349, 369, 380, 386, 390, 390, 372,
388, 393, 384, 348, 351, 375, 383, 389, 393, 396, 400, 390, 360, 349, 370, 383, 391, 393, 387, 380,
389, 390, 377, 346, 353, 373, 382, 386, 390, 391, 393, 373, 355, 348, 369, 384, 392, 395, 394, 382,
394, 395, 386, 353, 347, 370, 379, 389, 397, 398, 403, 401, 365, 352, 371, 389, 396, 399, 402, 397,
392, 392, 383, 356, 353, 373, 382, 389, 396, 394, 403, 400, 372, 350, 370, 381, 390, 390, 385, 381,
389, 388, 384, 362, 357, 370, 378, 387, 394, 394, 400, 403, 384, 352, 367, 385, 392, 394, 398, 403,
393, 393, 389, 363, 361, 374, 380, 386, 396, 397, 397, 396, 374, 349, 365, 381, 391, 393, 395, 387,
393, 395, 388, 370, 358, 369, 385, 393, 396, 398, 401, 402, 379, 350, 370, 383, 391, 393, 396, 401,
};
int frame2[]={
383, 346, 342, 334, 341, 370, 377, 380, 389, 390, 375, 346, 344, 347, 372, 386, 390, 396, 381, 350,
374, 376, 358, 338, 344, 368, 379, 387, 392, 396, 391, 356, 352, 347, 368, 382, 389, 387, 397, 348,
377, 369, 350, 336, 339, 371, 378, 380, 386, 396, 390, 352, 347, 347, 368, 381, 380, 391, 387, 348,
379, 380, 364, 335, 340, 371, 375, 389, 389, 388, 396, 353, 347, 345, 366, 380, 388, 391, 396, 360,
385, 378, 354, 336, 337, 365, 373, 383, 386, 392, 387, 353, 347, 346, 365, 379, 388, 389, 400, 352,
383, 389, 368, 338, 340, 367, 377, 382, 390, 389, 396, 362, 352, 344, 364, 380, 384, 389, 394, 380,
391, 397, 360, 336, 337, 362, 375, 381, 389, 390, 395, 360, 348, 339, 359, 376, 383, 383, 394, 365,
387, 394, 386, 344, 340, 363, 377, 386, 393, 394, 399, 384, 364, 339, 363, 377, 386, 391, 391, 372,
388, 394, 373, 343, 340, 356, 374, 384, 387, 389, 396, 368, 352, 338, 356, 378, 390, 384, 389, 367,
386, 391, 386, 348, 340, 353, 369, 385, 389, 392, 397, 396, 363, 337, 359, 378, 386, 391, 392, 375,
386, 390, 385, 346, 342, 365, 378, 385, 391, 387, 390, 382, 365, 340, 356, 375, 388, 392, 395, 385,
386, 390, 395, 347, 343, 358, 373, 384, 395, 394, 395, 400, 374, 340, 357, 375, 388, 389, 392, 395,
389, 394, 394, 352, 342, 357, 375, 382, 390, 391, 394, 395, 367, 341, 360, 373, 384, 388, 397, 389,
390, 390, 394, 357, 347, 363, 377, 386, 392, 394, 402, 404, 381, 342, 359, 376, 388, 394, 390, 396,
391, 391, 392, 356, 351, 359, 376, 382, 390, 389, 400, 394, 373, 343, 360, 376, 390, 396, 401, 399,
399, 395, 395, 371, 352, 357, 371, 382, 396, 396, 400, 407, 389, 349, 358, 381, 394, 396, 405, 409,
394, 392, 390, 375, 352, 361, 375, 384, 397, 392, 403, 407, 399, 345, 360, 374, 389, 391, 389, 396,
391, 389, 387, 382, 360, 362, 372, 382, 393, 391, 400, 402, 405, 353, 357, 378, 391, 391, 397, 409,
396, 392, 396, 381, 364, 365, 374, 381, 395, 397, 396, 401, 398, 346, 355, 372, 389, 390, 399, 402,
396, 397, 395, 385, 367, 358, 376, 389, 395, 395, 400, 402, 402, 346, 359, 376, 389, 391, 396, 405,
};
*/




int main()
{
	int dx,dy;
	
	clock_init();
	port_init();

	srinivasan2D_16bit(frame1,frame2,&dx,&dy);
	
	while(1) Nop();
	
	return 0;
}
