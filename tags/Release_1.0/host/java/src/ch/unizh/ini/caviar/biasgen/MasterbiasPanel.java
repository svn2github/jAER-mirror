/*
 * MasterbiasPanel.java
 *
 * Created on September 24, 2005, 10:06 PM
 */

package ch.unizh.ini.caviar.biasgen;

import ch.unizh.ini.caviar.util.EngineeringFormat;
import java.awt.*;
import java.util.Observer;

/**
 * A penel for displaying and controlling the masterbias.
 * @author  tobi
 */
public class MasterbiasPanel extends javax.swing.JPanel implements Observer {
    EngineeringFormat f=new EngineeringFormat();
    public Masterbias masterbias;
    
    public MasterbiasPanel(){
        initComponents();
    }
    
    /** Creates new form MasterbiasPanel */
    public MasterbiasPanel(Masterbias masterbias) {
        initComponents();
        setMasterbias(masterbias);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        rintTextBox = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        rxTextBox = new javax.swing.JTextField();
        jSeparator1 = new javax.swing.JSeparator();
        jPanel3 = new javax.swing.JPanel();
        jSeparator2 = new javax.swing.JSeparator();
        rIntEnabledCheckBox = new javax.swing.JCheckBox();
        rtotalLabel = new javax.swing.JLabel();
        jSeparator5 = new javax.swing.JSeparator();
        jPanel4 = new javax.swing.JPanel();
        imEstimatedLabel = new javax.swing.JLabel();
        jSeparator3 = new javax.swing.JSeparator();
        jPanel2 = new javax.swing.JPanel();
        powerDownCheckBox = new javax.swing.JCheckBox();

        setLayout(new javax.swing.BoxLayout(this, javax.swing.BoxLayout.Y_AXIS));

        setBorder(new javax.swing.border.TitledBorder("Masterbias"));
        jLabel1.setText("Rint");
        jLabel1.setToolTipText("On-chip resistance");
        jPanel1.add(jLabel1);

        rintTextBox.setColumns(7);
        rintTextBox.setText("value");
        rintTextBox.setToolTipText("On-chip masterbias resistance");
        rintTextBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rintTextBoxActionPerformed(evt);
            }
        });

        jPanel1.add(rintTextBox);

        jLabel3.setText("Rx");
        jPanel1.add(jLabel3);

        rxTextBox.setColumns(8);
        rxTextBox.setText("value");
        rxTextBox.setToolTipText("Off-chip masterbias resistance");
        rxTextBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rxTextBoxActionPerformed(evt);
            }
        });

        jPanel1.add(rxTextBox);

        add(jPanel1);

        add(jSeparator1);

        jPanel3.add(jSeparator2);

        rIntEnabledCheckBox.setText("Using Rint");
        rIntEnabledCheckBox.setToolTipText("Select if also using internal resistor");
        rIntEnabledCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rIntEnabledCheckBoxActionPerformed(evt);
            }
        });

        jPanel3.add(rIntEnabledCheckBox);

        rtotalLabel.setText("Rotal");
        rtotalLabel.setToolTipText("Total biasgen resistance");
        jPanel3.add(rtotalLabel);

        add(jPanel3);

        add(jSeparator5);

        imEstimatedLabel.setText("Estimated Im");
        imEstimatedLabel.setToolTipText("Estimated current");
        jPanel4.add(imEstimatedLabel);

        add(jPanel4);

        add(jSeparator3);

        powerDownCheckBox.setText("powerDown");
        powerDownCheckBox.setToolTipText("enable to power off masterbias");
        powerDownCheckBox.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        powerDownCheckBox.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                powerDownCheckBoxActionPerformed(evt);
            }
        });

        jPanel2.add(powerDownCheckBox);

        add(jPanel2);

    }
    // </editor-fold>//GEN-END:initComponents
    
    private void rIntEnabledCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rIntEnabledCheckBoxActionPerformed
        masterbias.setInternalResistorUsed(rIntEnabledCheckBox.isSelected());
    }//GEN-LAST:event_rIntEnabledCheckBoxActionPerformed
    
    private void rxTextBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rxTextBoxActionPerformed
        if(masterbias!=null){
            try{
                masterbias.setRExternal(f.parseFloat(rxTextBox.getText()));
            }catch(NumberFormatException e){
                Toolkit.getDefaultToolkit().beep();
                rxTextBox.selectAll();
            }
        }
    }//GEN-LAST:event_rxTextBoxActionPerformed
    
    private void powerDownCheckBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_powerDownCheckBoxActionPerformed
        masterbias.setPowerDownEnabled(powerDownCheckBox.isSelected());
    }//GEN-LAST:event_powerDownCheckBoxActionPerformed
    
    private void rintTextBoxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rintTextBoxActionPerformed
        if(masterbias!=null){
            try{
                masterbias.setRInternal(f.parseFloat(rxTextBox.getText()));
            }catch(NumberFormatException e){
                Toolkit.getDefaultToolkit().beep();
                rintTextBox.selectAll();
            }
        }
    }//GEN-LAST:event_rintTextBoxActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel imEstimatedLabel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JSeparator jSeparator5;
    private javax.swing.JCheckBox powerDownCheckBox;
    private javax.swing.JCheckBox rIntEnabledCheckBox;
    private javax.swing.JTextField rintTextBox;
    private javax.swing.JLabel rtotalLabel;
    private javax.swing.JTextField rxTextBox;
    // End of variables declaration//GEN-END:variables
    
    
    public Masterbias getMasterbias() {
        return this.masterbias;
    }
    
    public void setMasterbias(final Masterbias masterbias) {
        this.masterbias = masterbias;
        masterbias.addObserver(this);
        updateAppearance();
    }
    
    
    private void updateAppearance() {
        rxTextBox.setText(f.format(masterbias.getRExternal()));
        rintTextBox.setText(f.format(masterbias.getRInternal()));
        rtotalLabel.setText("Rtotal="+f.format(masterbias.getTotalResistance()));
        imEstimatedLabel.setText("Estimated Im="+f.format(masterbias.getCurrent()));
        rIntEnabledCheckBox.setSelected(masterbias.isInternalResistorUsed());
    }
    
    public void update(java.util.Observable observable, Object obj) {
        // something in masterbias has changed
//        System.out.println("masterbias panel update");
        updateAppearance();
    }
}
